var app=function(){"use strict";function t(){}function e(t){return t()}function i(){return Object.create(null)}function s(t){t.forEach(e)}function n(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let a,o;function l(t,e){return a||(a=document.createElement("a")),a.href=e,t===a.href}function c(t,e){t.appendChild(e)}function u(t,e,i){t.insertBefore(e,i||null)}function h(t){t.parentNode.removeChild(t)}function d(t){return document.createElement(t)}function p(){return t=" ",document.createTextNode(t);var t}function m(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function g(t,e,i){e in t?t[e]="boolean"==typeof t[e]&&""===i||i:m(t,e,i)}function f(t){o=t}const v=[],b=[],y=[],_=[],C=Promise.resolve();let w=!1;function T(t){y.push(t)}let x=!1;const A=new Set;function E(){if(!x){x=!0;do{for(let t=0;t<v.length;t+=1){const e=v[t];f(e),$(e.$$)}for(f(null),v.length=0;b.length;)b.pop()();for(let t=0;t<y.length;t+=1){const e=y[t];A.has(e)||(A.add(e),e())}y.length=0}while(v.length);for(;_.length;)_.pop()();w=!1,x=!1,A.clear()}}function $(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(T)}}const S=new Set;function R(t,e){-1===t.$$.dirty[0]&&(v.push(t),w||(w=!0,C.then(E)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function k(r,a,l,c,u,d,p,m=[-1]){const g=o;f(r);const v=r.$$={fragment:null,ctx:null,props:d,update:t,not_equal:u,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(g?g.$$.context:[])),callbacks:i(),dirty:m,skip_bound:!1,root:a.target||g.$$.root};p&&p(v.root);let b=!1;if(v.ctx=l?l(r,a.props||{},((t,e,...i)=>{const s=i.length?i[0]:e;return v.ctx&&u(v.ctx[t],v.ctx[t]=s)&&(!v.skip_bound&&v.bound[t]&&v.bound[t](s),b&&R(r,t)),e})):[],v.update(),b=!0,s(v.before_update),v.fragment=!!c&&c(v.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);v.fragment&&v.fragment.l(t),t.forEach(h)}else v.fragment&&v.fragment.c();a.intro&&((y=r.$$.fragment)&&y.i&&(S.delete(y),y.i(_))),function(t,i,r,a){const{fragment:o,on_mount:l,on_destroy:c,after_update:u}=t.$$;o&&o.m(i,r),a||T((()=>{const i=l.map(e).filter(n);c?c.push(...i):s(i),t.$$.on_mount=[]})),u.forEach(T)}(r,a.target,a.anchor,a.customElement),E()}var y,_;f(g)}var I=Object.defineProperty,U=(t,e,i)=>(((t,e,i)=>{e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i),L={};((t,e)=>{for(var i in(t=>{I(t,"__esModule",{value:!0})})(t),e)I(t,i,{get:e[i],enumerable:!0})})(L,{ActivityCaption:()=>Ae,ActivityIcon:()=>Ee,BlockComponent:()=>Z,CameraSource:()=>oe,CloudImageEditor:()=>ye,ConfirmationDialog:()=>ne,DataOutput:()=>xe,DefaultWidget:()=>$e,DropArea:()=>it,EditableCanvas:()=>be,ExternalSource:()=>we,FileItem:()=>ee,Icon:()=>Q,MessageBox:()=>Qt,Modal:()=>ie,ProgressBar:()=>ce,SimpleBtn:()=>tt,SourceBtn:()=>st,SourceList:()=>nt,StartFrom:()=>et,Tabs:()=>Te,UploadDetails:()=>le,UploadList:()=>re,UrlSource:()=>ae});var P=class{constructor(t){this.uid=Symbol(),this.name=t.name||null,t.schema.constructor===Object?this.store=function(t){let e=t=>{var i;for(let s in t)(null==(i=t[s])?void 0:i.constructor)===Object&&(t[s]=e(t[s]));return{...t}};return e(t)}(t.schema):(this._storeIsProxy=!0,this.store=t.schema),this.callbackMap=Object.create(null)}static warn(t,e){console.warn(`Symbiote Data: cannot ${t}. Prop name: `+e)}read(t){return this._storeIsProxy||this.store.hasOwnProperty(t)?this.store[t]:(P.warn("read",t),null)}has(t){return this._storeIsProxy?void 0!==this.store[t]:this.store.hasOwnProperty(t)}add(t,e,i=!0){!i&&Object.keys(this.store).includes(t)||(this.store[t]=e,this.callbackMap[t]&&this.callbackMap[t].forEach((e=>{e(this.store[t])})))}pub(t,e){this._storeIsProxy||this.store.hasOwnProperty(t)?this.add(t,e):P.warn("publish",t)}multiPub(t){for(let e in t)this.pub(e,t[e])}notify(t){this.callbackMap[t]&&this.callbackMap[t].forEach((e=>{e(this.store[t])}))}sub(t,e,i=!0){return this._storeIsProxy||this.store.hasOwnProperty(t)?(this.callbackMap[t]||(this.callbackMap[t]=new Set),this.callbackMap[t].add(e),i&&e(this.store[t]),{remove:()=>{this.callbackMap[t].delete(e),this.callbackMap[t].size||delete this.callbackMap[t]},callback:e}):(P.warn("subscribe",t),null)}remove(){delete P.globalStore[this.uid]}static registerLocalCtx(t){let e=new P({schema:t});return P.globalStore[e.uid]=e,e}static registerNamedCtx(t,e){let i=P.globalStore[t];return i?console.warn('State: context name "'+t+'" already in use'):(i=new P({name:t,schema:e}),P.globalStore[t]=i),i}static clearNamedCtx(t){delete P.globalStore[t]}static getNamedCtx(t,e=!0){return P.globalStore[t]||(e&&console.warn('State: wrong context name - "'+t+'"'),null)}};P.globalStore=Object.create(null);var M=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym"}),N="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",O=N.length-1,D=class{static generate(t="XXXXXXXXX-XXX"){let e="";for(let i=0;i<t.length;i++)e+="-"===t[i]?t[i]:N.charAt(Math.random()*O);return e}};var B=[function(t,e){if(e.renderShadow)return;let i=[...t.querySelectorAll("slot")];if(e.__initChildren.length&&i.length){let t={};i.forEach((e=>{let i=e.getAttribute("name");i?t[i]={slot:e,fr:document.createDocumentFragment()}:t.__default__={slot:e,fr:document.createDocumentFragment()}})),e.__initChildren.forEach((e=>{var i;let s=null==(i=e.getAttribute)?void 0:i.call(e,"slot");s?t[s].fr.appendChild(e):t.__default__&&t.__default__.fr.appendChild(e)})),Object.values(t).forEach((t=>{t.slot.parentNode.insertBefore(t.fr,t.slot),t.slot.remove()}))}else e.innerHTML=""},function(t,e){[...t.querySelectorAll(`[${M.EL_REF_ATTR}]`)].forEach((t=>{let i=t.getAttribute(M.EL_REF_ATTR);e.ref[i]=t,t.removeAttribute(M.EL_REF_ATTR)}))},function(t,e){[...t.querySelectorAll(`[${M.BIND_ATTR}]`)].forEach((t=>{t.getAttribute(M.BIND_ATTR).split(";").forEach((i=>{if(!i)return;let s,n=i.split(":").map((t=>t.trim())),r=n[0];0===r.indexOf(M.ATTR_BIND_PRFX)&&(s=!0,r=r.replace(M.ATTR_BIND_PRFX,""));let a,o,l,c,u=n[1].split(",").map((t=>t.trim()));if(r.includes(".")){a=!0;let e=r.split(".");c=()=>{o=t,e.forEach(((t,i)=>{i<e.length-1?o=o[t]:l=t}))},c()}for(let i of u)e.sub(i,(e=>{s?(null==e?void 0:e.constructor)===Boolean?e?t.setAttribute(r,""):t.removeAttribute(r):t.setAttribute(r,e):a?o?o[l]=e:window.setTimeout((()=>{c(),o[l]=e})):t[r]=e}))})),t.removeAttribute(M.BIND_ATTR)}))}],j=0,F=class extends HTMLElement{render(t,e=this.renderShadow){let i;if(t||this.constructor.template){for(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template);this.firstChild;)this.firstChild.remove();if((null==t?void 0:t.constructor)===DocumentFragment)i=t;else if((null==t?void 0:t.constructor)===String){let e=document.createElement("template");e.innerHTML=t,i=e.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let t of this.tplProcessors)t(i,this)}e?(this.shadowRoot||this.attachShadow({mode:"open"}),i&&this.shadowRoot.appendChild(i)):i&&this.appendChild(i)}addTemplateProcessor(t){this.tplProcessors.add(t)}constructor(){super(),this.init$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=D.generate(),this.style.setProperty(M.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(M.CSS_CTX_PROP,!0)}get ctxName(){var t;return(null==(t=this.getAttribute(M.CTX_NAME_ATTR))?void 0:t.trim())||this.cssCtxName||this.autoCtxName}get localCtx(){return this.__localCtx||(this.__localCtx=P.registerLocalCtx({})),this.__localCtx}get nodeCtx(){return P.getNamedCtx(this.ctxName,!1)||P.registerNamedCtx(this.ctxName,{})}static __parseProp(t,e){let i,s;if(t.startsWith(M.EXT_DATA_CTX_PRFX))i=e.nodeCtx,s=t.replace(M.EXT_DATA_CTX_PRFX,"");else if(t.includes(M.NAMED_DATA_CTX_SPLTR)){let e=t.split(M.NAMED_DATA_CTX_SPLTR);i=P.getNamedCtx(e[0]),s=e[1]}else i=e.localCtx,s=t;return{ctx:i,name:s}}sub(t,e){let i=F.__parseProp(t,this);this.allSubs.add(i.ctx.sub(i.name,e))}notify(t){let e=F.__parseProp(t,this);e.ctx.notify(e.name)}has(t){let e=F.__parseProp(t,this);return e.ctx.has(e.name)}add(t,e){let i=F.__parseProp(t,this);i.ctx.add(i.name,e,!1)}add$(t){for(let e in t)this.add(e,t[e])}get $(){if(!this.__stateProxy){let t=Object.create(null);this.__stateProxy=new Proxy(t,{set:(t,e,i)=>{let s=F.__parseProp(e,this);return s.ctx.pub(s.name,i),!0},get:(t,e)=>{let i=F.__parseProp(e,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(t){for(let e in t)this.$[e]=t[e]}initCallback(){}__initDataCtx(){let t=this.constructor.__attrDesc;if(t)for(let e of Object.values(t))Object.keys(this.init$).includes(e)||(this.init$[e]="");for(let t in this.init$)if(t.startsWith(M.EXT_DATA_CTX_PRFX))this.nodeCtx.add(t.replace(M.EXT_DATA_CTX_PRFX,""),this.init$[t]);else if(t.includes(M.NAMED_DATA_CTX_SPLTR)){let e=t.split(M.NAMED_DATA_CTX_SPLTR),i=e[0].trim(),s=e[1].trim();if(i&&s){let e=P.getNamedCtx(i,!1);e||(e=P.registerNamedCtx(i,{})),e.add(s,this.init$[t])}}else this.localCtx.add(t,this.init$[t]);this.__dataCtxInitialized=!0}connectedCallback(){var t,e;if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=null==(t=this.getAttribute(M.CTX_NAME_ATTR))?void 0:t.trim();i&&this.style.setProperty(M.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this.__initChildren=[...this.childNodes];for(let t of B)this.addTemplateProcessor(t);this.pauseRender||this.render(),null==(e=this.initCallback)||e.call(this)}this.connectedOnce=!0}destroyCallback(){}disconnectedCallback(){this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout((()=>{this.destroyCallback();for(let t of this.allSubs)t.remove(),this.allSubs.delete(t);for(let t of this.tplProcessors)this.tplProcessors.delete(t)}),100))}static reg(t,e=!1){t||(j++,t=`${M.AUTO_TAG_PRFX}-${j}`),this.__tag=t,window.customElements.get(t)?console.warn(`${t} - is already in "customElements" registry`):window.customElements.define(t,e?class extends(this){}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(t){this.observedAttributes=Object.keys(t),this.__attrDesc=t}attributeChangedCallback(t,e,i){if(e===i)return;let s=this.constructor.__attrDesc[t];s?this.__dataCtxInitialized?this.$[s]=i:this.init$[s]=i:this[t]=i}getCssData(t,e=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(t)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(t).trim();i.startsWith("'")&&i.endsWith("'")&&(i=i.replace(/\'/g,'"'));try{this.__cssDataCache[t]=JSON.parse(i)}catch(i){!e&&console.warn(`CSS Data error: ${t}`),this.__cssDataCache[t]=null}}return this.__cssDataCache[t]}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(t,e,i){let s="__"+t;this[s]=this[t],Object.defineProperty(this,t,{set:t=>{this[s]=t,i?window.setTimeout((()=>{null==e||e(t)})):null==e||e(t)},get:()=>this[s]}),this[t]=this[s]}},K="[Typed State] Wrong property name: ",q=class{static _print(t){console.warn(t)}static setDefaultTitle(t){this.defaultTitle=t}static setRoutingMap(t){Object.assign(this.appMap,t);for(let t in this.appMap)this.defaultRoute||!0!==this.appMap[t].default?!this.errorRoute&&!0===this.appMap[t].error&&(this.errorRoute=t):this.defaultRoute=t}static set routingEventName(t){this.__routingEventName=t}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let t={route:null,options:{}};return window.location.search.split(this.separator).forEach((e=>{if(e.includes("?"))t.route=e.replace("?","");else if(e.includes("=")){let i=e.split("=");t.options[i[0]]=decodeURI(i[1])}else t.options[e]=!0})),t}static notify(){let t=this.readAddressBar(),e=this.appMap[t.route];if(e&&e.title&&(document.title=e.title),null===t.route&&this.defaultRoute)return void this.applyRoute(this.defaultRoute);if(!e&&this.errorRoute)return void this.applyRoute(this.errorRoute);if(!e&&this.defaultRoute)return void this.applyRoute(this.defaultRoute);if(!e)return void this._print(`Route "${t.route}" not found...`);let i=new CustomEvent(q.routingEventName,{detail:{route:t.route,options:Object.assign(e||{},t.options)}});window.dispatchEvent(i)}static reflect(t,e={}){let i=this.appMap[t];if(!i)return void this._print("Wrong route: "+t);let s="?"+t;for(let t in e)!0===e[t]?s+=this.separator+t:s+=this.separator+t+`=${e[t]}`;let n=i.title||this.defaultTitle||"";window.history.pushState(null,n,s),document.title=n}static applyRoute(t,e={}){this.reflect(t,e),this.notify()}static setSeparator(t){this._separator=t}static get separator(){return this._separator||"&"}static createRouterData(t,e){this.setRoutingMap(e);let i=P.registerNamedCtx(t,{route:null,options:null,title:null});return window.addEventListener(this.routingEventName,(t=>{var e;i.multiPub({route:t.detail.route,options:t.detail.options,title:(null==(e=t.detail.options)?void 0:e.title)||this.defaultTitle||""})})),q.notify(),i}};function X(t,e){for(let i in e)i.includes("-")?t.style.setProperty(i,e[i]):t.style[i]=e[i]}function V(t,e){for(let i in e)e[i].constructor===Boolean?e[i]?t.setAttribute(i,""):t.removeAttribute(i):t.setAttribute(i,e[i])}function z(t={tag:"div"}){let e=document.createElement(t.tag);if(t.attributes&&V(e,t.attributes),t.styles&&X(e,t.styles),t.properties)for(let i in t.properties)e[i]=t.properties[i];return t.processors&&t.processors.forEach((t=>{t(e)})),t.children&&t.children.forEach((t=>{let i=z(t);e.appendChild(i)})),e}function H(t,e){[...t.querySelectorAll("[l10n]")].forEach((t=>{let i=t.getAttribute("l10n"),s="textContent";if(i.includes(":")){let t=i.split(":");s=t[0],i=t[1]}let n="l10n:"+i;e.__l10nKeys.push(n),e.add(n,i),e.sub(n,(i=>{t[s]=e.l10n(i)})),t.removeAttribute("l10n")}))}q.appMap=Object.create(null),window.onpopstate=()=>{q.notify()};var W=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadErrorMsg:{type:String,value:null},validationErrorMsg:{type:String,value:null},ctxName:{type:String,value:null},transformationsUrl:{type:String,value:null}}),G="active",J="complete"===document.readyState;J||window.addEventListener("load",(()=>{J=!0}));var Y=!1,Z=class extends F{l10n(t){return this.getCssData("--l10n-"+t)}constructor(){super(),this.activityType=null,this.addTemplateProcessor(H),this.__l10nKeys=[],this.__l10nUpdate=()=>{this.dropCssDataCache();for(let t of this.__l10nKeys)this.notify(t)},window.addEventListener("uc-l10n-update",this.__l10nUpdate)}applyL10nKey(t,e){this.$["l10n:"+t]=e}historyBack(){let t=this.$["*history"];t.pop();let e=t.pop();this.$["*currentActivity"]=e,t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.$["*history"]=t}addFiles(t){t.forEach((t=>{this.uploadCollection.add({file:t,isImage:t.type.includes("image"),mimeType:t.type,fileName:t.name,fileSize:t.size})}))}openSystemDialog(){this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.cfg("multiple"),this.fileInput.max=this.cfg("max-files"),this.fileInput.accept=this.cfg("accept"),this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=Z.activities.UPLOAD_LIST,this.cfg("confirm-upload")||(this.$["*currentActivity"]=""),this.fileInput.value="",this.fileInput=null}}connectedCallback(){let t=()=>{J?this.connected():window.addEventListener("load",(()=>{this.connected()}))},e=this.getAttribute("css-src");if(e){this.renderShadow=!0,this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.onload=()=>{window.requestAnimationFrame((()=>{t()}))},this.shadowRoot.appendChild(i)}else t()}connected(){this.__connectedOnce?super.connectedCallback():(Y||(this.add$({"*currentActivity":"","*currentActivityParams":{},"*history":[],"*commonProgress":0,"*uploadList":[],"*outputData":null}),Y=!0),super.connectedCallback(),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",(t=>{var e,i;if(t&&this.activityType===t){let s=this.$["*history"];t&&s[s.length-1]!==t&&s.push(t),this.setAttribute(G,"");let n=Z._activityRegistry[t];if(n&&(null==(e=n.activateCallback)||e.call(n),Z._lastActivity)){let t=Z._activityRegistry[Z._lastActivity];t&&(null==(i=t.deactivateCallback)||i.call(t))}}else this.removeAttribute(G);Z._lastActivity=t}))),this.__connectedOnce=!0)}registerActivity(t,e,i){Z._activityRegistry||(Z._activityRegistry=Object.create(null)),Z._activityRegistry[t]={activateCallback:e,deactivateCallback:i}}get activityParams(){return this.$["*currentActivityParams"]}get uploadCollection(){if(!this.has("*uploadCollection")){let t=new class{constructor(t){this.__typedSchema=t.typedSchema,this.__ctxId=t.ctxName||D.generate(),this.__state=P.registerNamedCtx(this.__ctxId,{}),this.__watchList=t.watchList||[],this.__handler=t.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set;let e=Object.create(null);this.__notifyObservers=(t,i)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),e[t]||(e[t]=new Set),e[t].add(i),this.__observeTimeout=window.setTimeout((()=>{this.__observers.forEach((t=>{t({...e})})),e=Object.create(null)}))}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout((()=>{var t;null==(t=this.__handler)||t.call(this,[...this.__items])}))}add(t){let e=new class{constructor(t,e){this.__typedSchema=t,this.__ctxId=e||D.generate(),this.__schema=Object.keys(t).reduce(((e,i)=>(e[i]=t[i].value,e)),{}),this.__state=P.registerNamedCtx(this.__ctxId,this.__schema)}setValue(t,e){this.__typedSchema.hasOwnProperty(t)?(null==e?void 0:e.constructor)===this.__typedSchema[t].type?this.__state.pub(t,e):console.warn("[Typed State] Wrong property type: "+t):console.warn(K+t)}setMultipleValues(t){for(let e in t)this.setValue(e,t[e])}getValue(t){if(this.__typedSchema.hasOwnProperty(t))return this.__state.read(t);console.warn(K+t)}subscribe(t,e){return this.__state.sub(t,e)}remove(){this.__state.remove()}}(this.__typedSchema);for(let i in t)e.setValue(i,t[i]);return this.__state.add(e.__ctxId,e),this.__watchList.forEach((t=>{this.__subsMap[e.__ctxId]||(this.__subsMap[e.__ctxId]=[]),this.__subsMap[e.__ctxId].push(e.subscribe(t,(()=>{this.__notifyObservers(t,e.__ctxId)})))})),this.__items.add(e.__ctxId),this.notify(),e}read(t){return this.__state.read(t)}readProp(t,e){return this.read(t).getValue(e)}publishProp(t,e,i){this.read(t).setValue(e,i)}remove(t){this.__items.delete(t),this.notify(),this.__state.pub(t,null),delete this.__subsMap[t]}clearAll(){this.__items.forEach((t=>{this.remove(t)}))}observe(t){this.__observers.add(t)}unobserve(t){this.__observers.delete(t)}findItems(t){let e=[];return this.__items.forEach((i=>{let s=this.read(i);t(s)&&e.push(i)})),e}items(){return[...this.__items]}destroy(){this.__state.remove(),this.__observers=null;for(let t in this.__subsMap)this.__subsMap[t].forEach((t=>{t.remove()})),delete this.__subsMap[t]}}({typedSchema:W,watchList:["uploadProgress","uuid"],handler:t=>{this.$["*uploadList"]=t}});t.observe((e=>{if(e.uploadProgress){let e=0,i=t.findItems((t=>!t.getValue("uploadErrorMsg")));i.forEach((i=>{e+=t.readProp(i,"uploadProgress")})),this.$["*commonProgress"]=e/i.length}})),this.add("*uploadCollection",t)}return this.$["*uploadCollection"]}cfg(t){return this.getCssData("--cfg-"+t,!0)}output(){let t=[];this.uploadCollection.items().forEach((e=>{t.push(P.getNamedCtx(e).store)})),this.$["*outputData"]=t}destroyCallback(){window.removeEventListener("uc-l10n-update",this.__l10nUpdate),this.__l10nKeys=null}static reg(t){super.reg(t.startsWith("uc-")?t:"uc-"+t)}};Z._activityRegistry=Object.create(null),Z._lastActivity="",Z.activities=Object.freeze({SOURCE_SELECT:"source-select",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"}),Z.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),Z.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...Z.extSrcList});var Q=class extends Z{constructor(){super(...arguments),U(this,"init$",{path:""})}initCallback(){this.defineAccessor("name",(t=>{!t||(this.$.path=this.getCssData(`--icon-${t}`))}))}};Q.template='\n<svg\n  viewBox="0 0 24 24"\n  xmlns="http://www.w3.org/2000/svg">\n  <path set="@d: path"></path>\n</svg>\n',Q.bindAttributes({name:null});var tt=class extends Z{constructor(){super(...arguments),U(this,"init$",{"*simpleButtonText":""})}initCallback(){this.$["*simpleButtonText"]=this.cfg("multiple")?this.l10n("upload-files"):this.l10n("upload-file"),this.onclick=()=>{this.$["*uploadList"].length?this.set$({"*currentActivity":Z.activities.UPLOAD_LIST}):this.set$({"*currentActivity":Z.activities.SOURCE_SELECT})}}};tt.template='\n<button>\n  <uc-icon name="upload"></uc-icon>\n  <span set="textContent: *simpleButtonText"></span>\n  <slot></slot>\n</button>';var et=class extends Z{constructor(){super(...arguments),U(this,"activityType","source-select")}initCallback(){this.registerActivity(this.activityType,(()=>{this.set$({"*modalCaption":this.l10n("select-file-source"),"*modalIcon":"default"})}))}},it=class extends Z{initCallback(){this.addEventListener("dragover",(t=>{t.stopPropagation(),t.preventDefault()})),this.addEventListener("drop",(t=>{t.stopPropagation(),t.preventDefault(),t.dataTransfer.files&&([...t.dataTransfer.files].forEach((t=>{this.uploadCollection.add({file:t,isImage:t.type.includes("image"),mimeType:t.type,fileName:t.name,fileSize:t.size})})),this.set$({"*currentActivity":Z.activities.UPLOAD_LIST}))}),!1)}},st=class extends Z{constructor(){super(),U(this,"init$",{iconName:"default"}),this._registeredTypes={}}initTypes(){this.registerType({type:Z.sourceTypes.LOCAL,activity:"",onClick:()=>{this.openSystemDialog()}}),this.registerType({type:Z.sourceTypes.URL,activity:Z.activities.URL,textKey:"from-url"}),this.registerType({type:Z.sourceTypes.CAMERA,activity:Z.activities.CAMERA}),this.registerType({type:"draw",activity:Z.activities.DRAW,icon:"edit-draw"});for(let t of Object.values(Z.extSrcList))this.registerType({type:t,activity:Z.activities.EXTERNAL,activityParams:{externalSourceType:t}})}initCallback(){this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",(t=>{!t||this.applyType(t)}))}registerType(t){this._registeredTypes[t.type]=t}getType(t){return this._registeredTypes[t]}applyType(t){let e=this._registeredTypes[t],{textKey:i=t,icon:s=t,activity:n,onClick:r,activityParams:a={}}=e;this.applyL10nKey("src-type",`src-type-${i}`),this.$.iconName=s,this.onclick=t=>{this.set$({"*currentActivityParams":a,"*currentActivity":n}),r&&r(t)}}};st.template='\n<uc-icon set="@name: iconName"></uc-icon>\n<div class="txt" l10n="src-type"></div>\n',st.bindAttributes({type:null});var nt=class extends Z{initCallback(){let t=this.cfg("source-list");if(!t)return;let e=t.split(",").map((t=>t.trim())),i="";e.forEach((t=>{i+=`<uc-source-btn type="${t}"></uc-source-btn>`})),this.hasAttribute("wrap")?this.innerHTML=i:this.outerHTML=i}};var rt=class extends Error{constructor(t,e,i,s,n){super(),this.name="UploadClientError",this.message=t,this.code=e,this.request=i,this.response=s,this.headers=n,Object.setPrototypeOf(this,rt.prototype)}},at=(t="Request canceled")=>{let e=new rt(t);return e.isCancel=!0,e},ot=(t,e)=>{t&&(t.aborted?Promise.resolve().then(e):t.addEventListener("abort",(()=>e()),{once:!0}))},lt=({method:t,url:e,data:i,headers:s={},signal:n,onProgress:r})=>new Promise(((a,o)=>{let l=new XMLHttpRequest,c=(null==t?void 0:t.toUpperCase())||"GET",u=!1;l.open(c,e),s&&Object.entries(s).forEach((t=>{let[e,i]=t;void 0!==i&&!Array.isArray(i)&&l.setRequestHeader(e,i)})),l.responseType="text",ot(n,(()=>{u=!0,l.abort(),o(at())})),l.onload=()=>{if(200!=l.status)o(new Error(`Error ${l.status}: ${l.statusText}`));else{let t={method:c,url:e,data:i,headers:s||void 0,signal:n,onProgress:r},o=l.getAllResponseHeaders().trim().split(/[\r\n]+/),u={};o.forEach((function(t){let e=t.split(": "),i=e.shift(),s=e.join(": ");i&&void 0!==i&&(u[i]=s)}));let h=l.response,d=l.status;a({request:t,data:h,headers:u,status:d})}},l.onerror=()=>{u||o(new Error("Network error"))},r&&"function"==typeof r&&(l.upload.onprogress=t=>{r({value:t.loaded/t.total})}),i?l.send(i):l.send()}));var ct=function(t){return t},ut=t=>"file"===t[0];function ht(t){let e=new FormData;for(let i of t)if(Array.isArray(i[1]))i[1].forEach((t=>t&&e.append(i[0]+"[]",`${t}`)));else if(ut(i)){let t=i[2],s=ct(i[1]);e.append(i[0],s,t)}else null!=i[1]&&e.append(i[0],`${i[1]}`);return e}var dt=(t,e)=>void 0!==e?`${t}=${encodeURIComponent(e)}`:null,pt=t=>Object.entries(t).reduce(((t,[e,i])=>t.concat(Array.isArray(i)?i.map((t=>dt(`${e}[]`,t))):dt(e,i))),[]).filter((t=>!!t)).join("&"),mt=(t,e,i)=>[t,e,i&&Object.keys(i).length>0?"?":"",i&&pt(i)].filter(Boolean).join(""),gt="https://ucarecdn.com",ft="https://upload.uploadcare.com",vt=1,bt=26214400,yt=5242880,_t=4,Ct=3,wt="79ae88bd931ea68464d9",Tt="original";function xt({userAgent:t,publicKey:e="",integration:i=""}={}){let s="UploadcareUploadClient",n="2.0.0",r="JavaScript";return"string"==typeof t?t:"function"==typeof t?t({publicKey:e,libraryName:s,libraryVersion:n,languageName:r,integration:i}):`${[s,n,e].filter(Boolean).join("/")} (${[r,i].filter(Boolean).join("; ")})`}var At=/\W|_/g;function Et(t){return t&&"object"==typeof t?Object.keys(t).reduce(((e,i)=>(e[function(t){return t.split(At).map(((t,e)=>t.charAt(0)[e>0?"toUpperCase":"toLowerCase"]()+t.slice(1))).join("")}(i)]="object"==typeof t[i]?Et(t[i]):t[i],e)),{}):t}var $t={factor:2,time:100};function St(t,e=$t){let i=0;return function t(s){let n=Math.round(e.time*Math.pow(e.factor,i));return s({attempt:i,retry:e=>(t=>new Promise((e=>setTimeout(e,t))))(null!=e?e:n).then((()=>(i+=1,t(s))))})}(t)}var Rt,kt,It;function Ut(t,e){return St((({attempt:i,retry:s})=>t().catch((t=>{if("response"in t&&"RequestThrottledError"===(null==t?void 0:t.code)&&i<e)return s(function(t){let{headers:e}=t||{};return e&&1e3*Number.parseInt(e["x-throttle-wait-seconds"])||15e3}(t));throw t}))))}(kt=Rt||(Rt={})).Token="token",kt.FileInfo="file_info",function(t){t.Unknown="unknown",t.Waiting="waiting",t.Progress="progress",t.Error="error",t.Success="success"}(It||(It={}));function Lt(t,{publicKey:e,baseURL:i=ft,signal:s,integration:n,userAgent:r,retryThrottledRequestMaxTimes:a=vt}={}){return Ut((()=>lt({method:"GET",headers:e?{"X-UC-User-Agent":xt({publicKey:e,integration:n,userAgent:r})}:void 0,url:mt(i,"/from_url/status/",{jsonerrors:1,token:t}),signal:s}).then((({data:t,headers:e,request:i})=>{let s=Et(JSON.parse(t));if("error"in s&&!(t=>"status"in t&&t.status===It.Error)(s))throw new rt(s.error.content,void 0,i,s,e);return s}))),a)}function Pt(t,{publicKey:e,baseURL:i=ft,signal:s,source:n,integration:r,userAgent:a,retryThrottledRequestMaxTimes:o=vt}){return Ut((()=>lt({method:"GET",headers:{"X-UC-User-Agent":xt({publicKey:e,integration:r,userAgent:a})},url:mt(i,"/info/",{jsonerrors:1,pub_key:e,file_id:t,source:n}),signal:s}).then((({data:t,headers:e,request:i})=>{let s=Et(JSON.parse(t));if("error"in s)throw new rt(s.error.content,s.error.errorCode,i,s,e);return s}))),o)}var Mt=class{constructor(t,{baseCDN:e,defaultEffects:i,fileName:s}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.cdnUrlModifiers=null,this.originalUrl=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null;let{uuid:n,s3Bucket:r}=t,a=r?`https://${r}.s3.amazonaws.com/${n}/${t.filename}`:`${e}/${n}/`,o=i?`-/${i}`:null,l=`${a}${o||""}`,c=n?a:null;this.uuid=n,this.name=s||t.filename,this.size=t.size,this.isStored=t.isStored,this.isImage=t.isImage,this.mimeType=t.mimeType,this.cdnUrl=l,this.cdnUrlModifiers=o,this.originalUrl=c,this.originalFilename=t.originalFilename,this.imageInfo=Et(t.imageInfo),this.videoInfo=Et(t.videoInfo)}},Nt=({check:t,interval:e=500,signal:i})=>new Promise(((s,n)=>{let r;ot(i,(()=>{r&&clearTimeout(r),n(at("Poll cancelled"))}));let a=()=>{try{Promise.resolve(t(i)).then((t=>{t?s(t):r=setTimeout(a,e)})).catch((t=>n(t)))}catch(t){n(t)}};r=setTimeout(a,0)}));function Ot({file:t,publicKey:e,baseURL:i,source:s,integration:n,userAgent:r,retryThrottledRequestMaxTimes:a,signal:o,onProgress:l}){return Nt({check:o=>Pt(t,{publicKey:e,baseURL:i,signal:o,source:s,integration:n,userAgent:r,retryThrottledRequestMaxTimes:a}).then((t=>t.isReady?t:(l&&l({value:1}),!1))),signal:o})}var Dt=(t,{publicKey:e,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:d,baseCDN:p})=>function(t,{publicKey:e,fileName:i,baseURL:s=ft,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c="local",integration:u,userAgent:h,retryThrottledRequestMaxTimes:d=vt}){return Ut((()=>{var d;return lt({method:"POST",url:mt(s,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":xt({publicKey:e,integration:u,userAgent:h})},data:ht([["file",t,null!==(d=null!=i?i:t.name)&&void 0!==d?d:Tt],["UPLOADCARE_PUB_KEY",e],["UPLOADCARE_STORE",void 0===a?"auto":a?1:0],["signature",n],["expire",r],["source",c]]),signal:o,onProgress:l}).then((({data:t,headers:e,request:i})=>{let s=Et(JSON.parse(t));if("error"in s)throw new rt(s.error.content,s.error.errorCode,i,s,e);return s}))}),d)}(t,{publicKey:e,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:d}).then((({file:t})=>Ot({file:t,publicKey:e,baseURL:s,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:d,onProgress:l,signal:o}))).then((t=>new Mt(t,{baseCDN:p}))),{AbortController:Bt,AbortSignal:jt}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0,Ft=(t,{signal:e}={})=>{let i=null,s=null,n=t.map((()=>new Bt));return ot(e,(()=>{n.forEach((t=>t.abort()))})),Promise.all(t.map(((t,e)=>{let r=(t=>()=>{s=t,n.forEach(((e,i)=>i!==t&&e.abort()))})(e);return Promise.resolve().then((()=>t({stopRace:r,signal:n[e].signal}))).then((t=>(r(),t))).catch((t=>(i=t,null)))}))).then((t=>{if(null===s)throw i;return t[s]}))},Kt=window.WebSocket,qt=null,Xt=t=>{if(!qt){let e="undefined"==typeof window?0:3e4;qt=new class{constructor(t,e=3e4){this.ws=void 0,this.queue=[],this.isConnected=!1,this.subscribers=0,this.emmitter=new class{constructor(){this.events=Object.create({})}emit(t,e){var i;null===(i=this.events[t])||void 0===i||i.forEach((t=>t(e)))}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){this.events[t]=e?this.events[t].filter((t=>t!==e)):[]}},this.disconnectTimeoutId=null,this.key=t,this.disconnectTime=e}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let t=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Kt(t),this.ws.addEventListener("error",(t=>{this.emmitter.emit("error",new Error(t.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((t=>this.send(t.event,t.data))),this.queue=[]})),this.ws.addEventListener("message",(t=>{let e=JSON.parse(t.data.toString());switch(e.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(e.channel,((t,e)=>Object.assign("success"===t?{status:It.Success}:"progress"===t?{status:It.Progress}:{status:It.Error},e))(e.event,JSON.parse(e.data)))}}))}}disconnect(){let t=()=>{var t;null===(t=this.ws)||void 0===t||t.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{t()}),this.disconnectTime):t()}send(t,e){var i;let s=JSON.stringify({event:t,data:e});null===(i=this.ws)||void 0===i||i.send(s)}subscribe(t,e){this.subscribers+=1,this.connect();let i=`task-status-${t}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,e),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(t){this.subscribers-=1;let e=`task-status-${t}`,i={event:"pusher:unsubscribe",data:{channel:e}};this.emmitter.off(e),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter((t=>t.data.channel!==e)),0===this.subscribers&&this.disconnect()}onError(t){return this.emmitter.on("error",t),()=>this.emmitter.off("error",t)}}(t,e)}return qt};var Vt=(t,{publicKey:e,fileName:i,baseURL:s,baseCDN:n,checkForUrlDuplicates:r,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:u,onProgress:h,source:d,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,pusherKey:f=wt})=>Promise.resolve((t=>{Xt(t).connect()})(f)).then((()=>function(t,{publicKey:e,baseURL:i=ft,store:s,fileName:n,checkForUrlDuplicates:r,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,source:c="url",signal:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p=vt}){return Ut((()=>lt({method:"POST",headers:{"X-UC-User-Agent":xt({publicKey:e,integration:h,userAgent:d})},url:mt(i,"/from_url/",{jsonerrors:1,pub_key:e,source_url:t,store:void 0===s?"auto":s?1:void 0,filename:n,check_URL_duplicates:r?1:void 0,save_URL_duplicates:a?1:void 0,signature:o,expire:l,source:c}),signal:u}).then((({data:t,headers:e,request:i})=>{let s=Et(JSON.parse(t));if("error"in s)throw new rt(s.error.content,s.error.errorCode,i,s,e);return s}))),p)}(t,{publicKey:e,fileName:i,baseURL:s,checkForUrlDuplicates:r,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:u,source:d,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g}))).catch((t=>{let e=Xt(f);return null==e||e.disconnect(),Promise.reject(t)})).then((t=>t.type===Rt.FileInfo?t:Ft([({signal:i})=>function({token:t,publicKey:e,baseURL:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:r,onProgress:a,signal:o}){return Nt({check:o=>Lt(t,{publicKey:e,baseURL:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:r,signal:o}).then((e=>{switch(e.status){case It.Error:return new rt(e.error,e.errorCode);case It.Waiting:return!1;case It.Unknown:return new rt(`Token "${t}" was not found.`);case It.Progress:return a&&a({value:e.done/e.total}),!1;case It.Success:return a&&a({value:e.done/e.total}),e;default:throw new Error("Unknown status")}})),signal:o})}({token:t.token,publicKey:e,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:h,signal:i}),({signal:e})=>(({token:t,pusherKey:e,signal:i,onProgress:s})=>new Promise(((n,r)=>{let a=Xt(e),o=a.onError(r),l=()=>{o(),a.unsubscribe(t)};ot(i,(()=>{l(),r(at("pusher cancelled"))})),a.subscribe(t,(t=>{switch(t.status){case It.Progress:s&&s({value:t.done/t.total});break;case It.Success:l(),s&&s({value:t.done/t.total}),n(t);break;case It.Error:l(),r(new rt(t.msg,t.error_code))}}))})))({token:t.token,pusherKey:f,signal:e,onProgress:h})],{signal:u}))).then((t=>{if(t instanceof rt)throw t;return t})).then((t=>Ot({file:t.uuid,publicKey:e,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:h,signal:u}))).then((t=>new Mt(t,{baseCDN:n}))),zt=t=>void 0!==t&&("undefined"!=typeof Blob&&t instanceof Blob||"undefined"!=typeof File&&t instanceof File||"undefined"!=typeof Buffer&&t instanceof Buffer),Ht=t=>t.length||t.size;function Wt(t,e,i){return s=>((t,e,i,s)=>{let n=s*e,r=Math.min(n+s,i);return t.slice(n,r)})(t,s,e,i)}var Gt=(t,e)=>new Promise(((i,s)=>{let n=[],r=!1,a=e.length,o=[...e],l=()=>{let t=e.length-o.length,c=o.shift();c&&c().then((e=>{r||(n[t]=e,a-=1,a?l():i(n))})).catch((t=>{r=!0,s(t)}))};for(let e=0;e<t;e++)l()})),Jt=(t,e,{publicKey:i,onProgress:s,signal:n,integration:r,multipartMaxAttempts:a})=>St((({attempt:o,retry:l})=>function(t,e,{signal:i,onProgress:s}){return lt({method:"PUT",url:e,data:t,onProgress:s,signal:i}).then((t=>(s&&s({value:1}),t))).then((({status:t})=>({code:t})))}(t,e,{publicKey:i,onProgress:s,signal:n,integration:r}).catch((t=>{if(o<a)return l();throw t})))),Yt=(t,{publicKey:e,fileName:i,fileSize:s,baseURL:n,secureSignature:r,secureExpire:a,store:o,signal:l,onProgress:c,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,contentType:m,multipartChunkSize:g=yt,maxConcurrentRequests:f=_t,multipartMaxAttempts:v=Ct,baseCDN:b})=>{let y,_=s||Ht(t),C=(t,e)=>{if(!c)return;y||(y=Array(t).fill(0));let i=t=>t.reduce(((t,e)=>t+e),0);return({value:s})=>{y[e]=s,c({value:i(y)/t})}};return function(t,{publicKey:e,contentType:i,fileName:s,multipartChunkSize:n=yt,baseURL:r="",secureSignature:a,secureExpire:o,store:l,signal:c,source:u="local",integration:h,userAgent:d,retryThrottledRequestMaxTimes:p=vt}){return Ut((()=>lt({method:"POST",url:mt(r,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":xt({publicKey:e,integration:h,userAgent:d})},data:ht([["filename",null!=s?s:Tt],["size",t],["content_type",null!=i?i:"application/octet-stream"],["part_size",n],["UPLOADCARE_STORE",l?"":"auto"],["UPLOADCARE_PUB_KEY",e],["signature",a],["expire",o],["source",u]]),signal:c}).then((({data:t,headers:e,request:i})=>{let s=Et(JSON.parse(t));if("error"in s)throw new rt(s.error.content,s.error.errorCode,i,s,e);return s.parts=Object.keys(s.parts).map((t=>s.parts[t])),s}))),p)}(_,{publicKey:e,contentType:m,fileName:null!=i?i:t.name,baseURL:n,secureSignature:r,secureExpire:a,store:o,signal:l,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p}).then((({uuid:i,parts:s})=>{let n=Wt(t,_,g);return Promise.all([i,Gt(f,s.map(((t,i)=>()=>Jt(n(i),t,{publicKey:e,onProgress:C(s.length,i),signal:l,integration:h,multipartMaxAttempts:v}))))])})).then((([t])=>function(t,{publicKey:e,baseURL:i=ft,source:s="local",signal:n,integration:r,userAgent:a,retryThrottledRequestMaxTimes:o=vt}){return Ut((()=>lt({method:"POST",url:mt(i,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":xt({publicKey:e,integration:r,userAgent:a})},data:ht([["uuid",t],["UPLOADCARE_PUB_KEY",e],["source",s]]),signal:n}).then((({data:t,headers:e,request:i})=>{let s=Et(JSON.parse(t));if("error"in s)throw new rt(s.error.content,s.error.errorCode,i,s,e);return s}))),o)}(t,{publicKey:e,baseURL:n,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p}))).then((t=>t.isReady?t:Ot({file:t.uuid,publicKey:e,baseURL:n,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,onProgress:c,signal:l}))).then((t=>new Mt(t,{baseCDN:b})))};function Zt(t,{publicKey:e,fileName:i,baseURL:s=ft,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:d,contentType:p,multipartChunkSize:m,multipartMaxAttempts:g,maxConcurrentRequests:f,baseCDN:v=gt,checkForUrlDuplicates:b,saveUrlForRecurrentUploads:y,pusherKey:_}){if(zt(t)){return((t,e=bt)=>t>=e)(Ht(t))?Yt(t,{publicKey:e,contentType:p,multipartChunkSize:m,multipartMaxAttempts:g,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:h,maxConcurrentRequests:f,retryThrottledRequestMaxTimes:d,baseCDN:v}):Dt(t,{publicKey:e,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:d,baseCDN:v})}if((t=>{let e=new RegExp("^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$");return!zt(t)&&e.test(t)})(t))return Vt(t,{publicKey:e,fileName:i,baseURL:s,baseCDN:v,checkForUrlDuplicates:b,saveUrlForRecurrentUploads:y,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:d,pusherKey:_});if((t=>{let e=new RegExp("[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}");return!zt(t)&&e.test(t)})(t))return((t,{publicKey:e,fileName:i,baseURL:s,signal:n,onProgress:r,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,baseCDN:u})=>Pt(t,{publicKey:e,baseURL:s,signal:n,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c}).then((t=>new Mt(t,{baseCDN:u,fileName:i}))).then((t=>(r&&r({value:1}),t))))(t,{publicKey:e,fileName:i,baseURL:s,signal:o,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:d,baseCDN:v});throw new TypeError(`File uploading from "${t}" is not supported`)}var Qt=class extends Z{constructor(){super(...arguments),U(this,"init$",{iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){this.sub("*message",(t=>{t?(this.setAttribute("active",""),this.set$({captionTxt:t.caption,msgTxt:t.text,iconName:t.isError?"error":"info"}),t.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")}))}};Qt.template='\n<div class="heading">\n  <uc-icon set="@name: iconName"></uc-icon>\n  <div class="caption" set="textContent: captionTxt"></div>\n  <button set="onclick: onClose">\n    <uc-icon name="close"></uc-icon>\n  </button>\n</div>\n<div class="msg" set="textContent: msgTxt"></div>\n';var te="data:image/svg+xml;base64,";var ee=class extends Z{constructor(){super(...arguments),U(this,"pauseRender",!0),U(this,"init$",{fileName:"",thumb:"",thumbUrl:"",progressWidth:0,progressOpacity:1,notImage:!0,badgeIcon:"check","*focusedEntry":null,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this.entry,"*currentActivity":Z.activities.DETAILS})},onRemove:()=>{this.uploadCollection.remove(this.uid)},onUpload:()=>{this.upload()}})}_observerCallback(t){let[e]=t;0===e.intersectionRatio?(clearTimeout(this._thumbTimeoutId),this._thumbTimeoutId=void 0):this._thumbTimeoutId||(this._thumbTimeoutId=setTimeout((()=>this._generateThumbnail()),100))}_generateThumbnail(){var t;this.$.thumbUrl||((null==(t=this.file)?void 0:t.type.includes("image"))?function(t,e=40){let i=document.createElement("canvas"),s=i.getContext("2d"),n=new Image,r=new Promise(((t,r)=>{n.onload=()=>{let r=n.height/n.width;r>1?(i.width=e,i.height=e*r):(i.height=e,i.width=e/r),s.fillStyle="rgb(240, 240, 240)",s.fillRect(0,0,i.width,i.height),s.drawImage(n,0,0,i.width,i.height),i.toBlob((e=>{let i=URL.createObjectURL(e);t(i)}),"image/png")},n.onerror=t=>{console.warn("Resize error..."),r(t)}}));return n.src=URL.createObjectURL(t),r}(this.file,this.cfg("thumb-size")||76).then((t=>{this.$.thumbUrl=`url(${t})`})):this.$.thumbUrl=`url(${te+btoa('\n    <svg width="36" height="36" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <g filter="url(#a)">\n        <path d="m10 8.00298 11-.00029 5 4.99711v15.0027l-16 .0002V8.00298Z" fill="#fff"/>\n      </g>\n      <g filter="url(#b)">\n        <path d="m21 8 5 5h-5V8Z" fill="#fff"/>\n      </g>\n      <defs>\n        <filter id="a" x="8" y="6.50269" width="20" height="24" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n          <feFlood flood-opacity="0" result="BackgroundImageFix"/>\n          <feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n          <feOffset dy=".5"/>\n          <feGaussianBlur stdDeviation="1"/>\n          <feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.18 0"/>\n          <feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2684_2129"/>\n          <feBlend in="SourceGraphic" in2="effect1_dropShadow_2684_2129" result="shape"/>\n        </filter>\n        <filter id="b" x="19" y="7" width="8" height="8" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n          <feFlood flood-opacity="0" result="BackgroundImageFix"/>\n          <feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n          <feOffset dx="-.5" dy=".5"/>\n          <feGaussianBlur stdDeviation=".75"/>\n          <feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"/>\n          <feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2684_2129"/>\n          <feBlend in="SourceGraphic" in2="effect1_dropShadow_2684_2129" result="shape"/>\n        </filter>\n      </defs>\n    </svg>')})`)}_revokeThumbUrl(){var t;(null==(t=this.$.thumbUrl)?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(this.$.thumbUrl)}initCallback(){this.defineAccessor("entry-id",(t=>{var e;!t||(this.uid=t,this.entry=null==(e=this.uploadCollection)?void 0:e.read(t),this.entry.subscribe("fileName",(t=>{this.$.fileName=t||this.l10n("file-no-name")})),this.entry.subscribe("uuid",(t=>{if(!t)return;this._observer.unobserve(this),this.setAttribute("loaded","");let e=`https://ucarecdn.com/${t}/`;this._revokeThumbUrl();let i=this.cfg("thumb-size")||76;this.$.thumbUrl=`url(${e}-/scale_crop/${i}x${i}/)`})),this.entry.subscribe("transformationsUrl",(t=>{if(!t)return;this._revokeThumbUrl();let e=this.cfg("thumb-size")||76;this.$.thumbUrl=`url(${t}-/scale_crop/${e}x${e}/)`})),this.file=this.entry.getValue("file"),this.cfg("confirm-upload")||this.upload(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this))})),this.$["*uploadTrigger"]=null,ee.activeInstances.add(this),this.sub("*uploadTrigger",(t=>{!t||!this.isConnected||this.upload()})),this.onclick=()=>{ee.activeInstances.forEach((t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")}))}}destroyCallback(){ee.activeInstances.delete(this),this._observer.unobserve(this),clearTimeout(this._thumbTimeoutId)}async upload(){if(this.hasAttribute("loaded")||this.entry.getValue("uuid"))return;this.$.progressWidth=0,this.removeAttribute("focused"),this.removeAttribute("error"),this.setAttribute("uploading","");let t={},e=this.cfg("store");null!==e&&(t.store=!!e);try{let e=await Zt(this.file,{...t,publicKey:this.cfg("pubkey"),onProgress:t=>{let e=100*t.value;this.$.progressWidth=e+"%",this.entry.setValue("uploadProgress",e)}});this.$.progressOpacity=0,this.setAttribute("loaded",""),this.removeAttribute("uploading"),this.$.badgeIcon="badge-success",this.entry.setMultipleValues({uuid:e.uuid,uploadProgress:100})}catch(t){this.setAttribute("error",""),this.removeAttribute("uploading");let e=new class{constructor(){U(this,"caption",""),U(this,"text",""),U(this,"iconName",""),U(this,"isError",!1)}};e.caption=this.l10n("upload-error")+": "+this.file.name,e.text=t,e.isError=!0,this.set$({badgeIcon:"badge-error","*message":e}),this.entry.setValue("uploadErrorMsg",t)}}};ee.template='\n<div\n  class="thumb"\n  set="style.backgroundImage: thumbUrl">\n  <div class="badge">\n    <uc-icon set="@name: badgeIcon"></uc-icon>\n  </div>\n</div>\n<div class="file-name" set="textContent: fileName"></div>\n<button class="edit-btn" set="onclick: onEdit;">\n  <uc-icon name="edit-file"></uc-icon>\n</button>\n<button class="remove-btn" set="onclick: onRemove;">\n  <uc-icon name="remove-file"></uc-icon>\n</button>\n<button class="upload-btn" set="onclick: onUpload;">\n  <uc-icon name="upload"></uc-icon>\n</button>\n<div\n  class="progress"\n  set="style.width: progressWidth; style.opacity: progressOpacity">\n</div>\n',ee.activeInstances=new Set,ee.bindAttributes({"entry-id":null});var ie=class extends Z{constructor(){super(...arguments),U(this,"init$",{"*modalActive":!1,"*modalHeaderHidden":!1,closeClicked:()=>{this.$["*currentActivity"]=""}})}initCallback(){this.sub("*currentActivity",(t=>{this.set$({"*modalActive":!!t})})),this.sub("*uploadList",(t=>{!t.length&&this.$["*modalActive"]&&(this.$["*currentActivity"]=Z.activities.SOURCE_SELECT)})),this.sub("*modalActive",(t=>{t?this.setAttribute("active",""):this.removeAttribute("active")})),this.hasAttribute("strokes")&&(this.style.backgroundImage=`url(${function(t="rgba(0, 0, 0, .1)"){return te+btoa(`<svg height="10" width="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">\n    <line x1="0" y1="10" x2="10" y2="0" stroke="${t}" />\n  </svg>`)}()})`)}};ie.template='\n<div class="dialog">\n  <div class="heading" set="@hidden: *modalHeaderHidden">\n    <uc-activity-icon></uc-activity-icon>\n    <uc-activity-caption></uc-activity-caption>\n    <button\n      class="close-btn"\n      set="onclick: closeClicked">\n      <uc-icon name="close"></uc-icon>\n    </button>\n  </div>\n  <div class="content">\n    <slot></slot>\n  </div>\n</div>\n';var se=class{constructor(){U(this,"captionL10nStr","confirm-your-action"),U(this,"messsageL10Str","are-you-sure"),U(this,"confirmL10nStr","yes"),U(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}},ne=class extends Z{constructor(){super(...arguments),U(this,"activityType",Z.activities.CONFIRMATION),U(this,"_defaults",new se),U(this,"init$",{messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messsageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",(t=>{!t||this.set$({"*modalHeaderHidden":!0,"*currentActivity":Z.activities.CONFIRMATION,"*modalCaption":this.l10n(t.captionL10nStr),messageTxt:this.l10n(t.messsageL10Str),confirmBtnTxt:this.l10n(t.confirmL10nStr),denyBtnTxt:this.l10n(t.denyL10nStr),onDeny:()=>{this.$["*modalHeaderHidden"]=!1,t.denyAction()},onConfirm:()=>{this.$["*modalHeaderHidden"]=!1,t.confirmAction()}})}))}};ne.template='\n<div\n  class="message"\n  set="textContent: messageTxt">\n</div>\n<div class="toolbar">\n  <button\n    class="deny-btn secondary-btn"\n    set="textContent: denyBtnTxt; onclick: onDeny">\n  </button>\n  <button\n    class="confirm-btn primary-btn"\n    set="textContent: confirmBtnTxt; onclick: onConfirm">\n  </button>\n</div>\n';var re=class extends Z{constructor(){super(...arguments),U(this,"activityType",Z.activities.UPLOAD_LIST),U(this,"init$",{doneBtnHidden:!0,uploadBtnHidden:!1,uploadBtnDisabled:!1,hasFiles:!1,moreBtnDisabled:!0,onAdd:()=>{this.$["*currentActivity"]=Z.activities.SOURCE_SELECT},onUpload:()=>{this.set$({"*uploadTrigger":{}})},onDone:()=>{this.set$({"*currentActivity":""}),this.output()},onCancel:()=>{let t=new se;t.confirmAction=()=>{this.$["*currentActivity"]="",this.uploadCollection.clearAll()},t.denyAction=()=>{this.historyBack()},this.$["*confirmation"]=t}}),U(this,"_renderMap",Object.create(null))}initCallback(){this.registerActivity(this.activityType,(()=>{this.set$({"*modalCaption":this.l10n("selected"),"*modalIcon":"local"})})),this.$.moreBtnDisabled=!this.cfg("multiple"),this.uploadCollection.observe((()=>{let t=this.uploadCollection.findItems((t=>!t.getValue("uuid"))),e=this.uploadCollection.findItems((t=>!t.getValue("uuid")&&t.getValue("uploadProgress")>0)),i=0===t.length,s=e.length>0;this.set$({uploadBtnHidden:i,uploadBtnDisabled:s,doneBtnHidden:!i}),!this.cfg("confirm-upload")&&i&&this.$.onDone()})),this.sub("*uploadList",(t=>{if(0===t.length&&!this.cfg("show-empty-list"))return void(this.$["*currentActivity"]=Z.activities.SOURCE_SELECT);this.$.hasFiles=t.length>0,t.forEach((t=>{if(!this._renderMap[t]){let e=new ee;this._renderMap[t]=e}}));for(let e in this._renderMap)t.includes(e)||(this._renderMap[e].remove(),delete this._renderMap[e]);let e=document.createDocumentFragment();Object.values(this._renderMap).forEach((t=>e.appendChild(t))),this.ref.files.replaceChildren(e),Object.entries(this._renderMap).forEach((([t,e])=>{setTimeout((()=>{e["entry-id"]=t,e.render()}))}))}))}};re.template='\n<div class="no-files" set="@hidden: hasFiles">\n  <slot name="empty"><span l10n="no-files"></span></slot>\n</div>\n<div class="files" ref="files"></div>\n<div class="toolbar">\n  <button\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel;"\n    l10n="clear"></button>\n  <div></div>\n  <button\n    class="add-more-btn secondary-btn"\n    set="onclick: onAdd; @disabled: moreBtnDisabled"\n    l10n="add-more"></button>\n  <button\n    class="upload-btn primary-btn"\n    set="@hidden: uploadBtnHidden; onclick: onUpload; @disabled: uploadBtnDisabled"\n    l10n="upload"></button>\n  <button\n    class="done-btn primary-btn"\n    set="@hidden: doneBtnHidden; onclick: onDone"\n    l10n="done"></button>\n</div>\n';var ae=class extends Z{constructor(){super(...arguments),U(this,"activityType",Z.activities.URL),U(this,"init$",{onUpload:async()=>{let t=this.ref.input.value,e=this.cfg("pubkey"),i=this.uploadCollection.add({externalUrl:t}),s=await Zt(t,{publicKey:e,onProgress:t=>{let e=t.value;i.setValue("uploadProgress",e)}});console.log(s),i.setMultipleValues({uuid:s.uuid,fileName:s.name,fileSize:s.size,isImage:s.isImage,mimeType:s.mimeType}),this.$["*currentActivity"]=Z.activities.UPLOAD_LIST},onCancel:()=>{this.set$({"*currentActivity":Z.activities.SOURCE_SELECT})}})}initCallback(){this.registerActivity(this.activityType,(()=>{this.set$({"*modalCaption":this.l10n("caption-from-url"),"*modalIcon":"url"})}))}};ae.template='\n<input placeholder="https://..." .url-input type="text" ref="input" />\n<button \n  class="url-upload-btn primary-btn "\n  set="onclick: onUpload">\n</button>\n<button\n  class="cancel-btn secondary-btn"\n  set="onclick: onCancel"\n  l10n="cancel">\n</button>\n';var oe=class extends Z{constructor(){super(...arguments),U(this,"activityType",Z.activities.CAMERA),U(this,"init$",{video:null,videoTransformCss:this.cfg("camera-mirror")?"scaleX(-1)":null,onCancel:()=>{this.set$({"*currentActivity":Z.activities.SOURCE_SELECT})},onShot:()=>{this._shot()}})}async _init(){this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1}),this.$.video=this._stream}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let t=Date.now(),e=`camera-${t}.png`;this._canvas.toBlob((i=>{let s=new File([i],e,{lastModified:t,type:"image/png"});this.uploadCollection.add({file:s,fileName:e,fileSize:s.size,isImage:!0,mimeType:s.type}),this.set$({"*currentActivity":Z.activities.UPLOAD_LIST})}))}initCallback(){this.registerActivity(this.activityType,(()=>{this.set$({"*modalCaption":this.l10n("caption-camera"),"*modalIcon":"camera"})}),(()=>{var t;null==(t=this._stream)||t.getTracks()[0].stop(),this.$.video=null}))}};oe.template='\n<div .video-wrapper>\n  <video\n    autoplay\n    playsinline\n    set="srcObject: video; style.transform: videoTransformCss"\n    ref="video">\n  </video>\n</div>\n<div class="toolbar">\n  <button\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel"\n    l10n="cancel">\n  </button>\n  <button\n    class="shot-btn primary-btn"\n    set="onclick: onShot"\n    l10n="camera-shot">\n  </button>\n</div>\n';var le=class extends Z{constructor(){super(...arguments),U(this,"activityType",Z.activities.DETAILS),U(this,"init$",{fileSize:0,fileName:"",cdnUrl:"",errorTxt:"",editBtnHidden:!0,onNameInput:null,"*focusedEntry":null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.__ctxId),this.historyBack()},onEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=Z.activities.CLOUD_IMG_EDIT)}})}initCallback(){this.registerActivity(this.activityType,(()=>{this.set$({"*modalCaption":this.l10n("caption-edit-file")})})),this.eCanvas=this.ref.canvas,this.sub("*focusedEntry",(t=>{if(!t)return;this._entrySubs?this._entrySubs.forEach((t=>{this._entrySubs.delete(t),t.remove()})):this._entrySubs=new Set,this.entry=t;let e=t.getValue("file");e&&(this._file=e,this._file.type.includes("image")&&!t.getValue("transformationsUrl")&&(this.eCanvas.setImageFile(this._file),this.set$({editBtnHidden:!1})));let i=(t,e)=>{this._entrySubs.add(this.entry.subscribe(t,e))};i("fileName",(t=>{this.$.fileName=t,this.$.onNameInput=()=>{Object.defineProperty(this._file,"name",{writable:!0,value:this.ref.file_name_input.value})}})),i("fileSize",(t=>{this.$.fileSize=t})),i("uuid",(t=>{this.$.cdnUrl=t?`https://ucarecdn.com/${t}/`:"Not uploaded yet..."})),i("uploadErrorMsg",(t=>{this.$.errorTxt=t})),i("externalUrl",(t=>{!t||this.entry.getValue("isImage")&&!this.entry.getValue("transformationsUrl")&&this.eCanvas.setImageUrl(this.$.cdnUrl)})),i("transformationsUrl",(t=>{!t||this.entry.getValue("isImage")&&this.eCanvas.setImageUrl(t)}))}))}};le.template='\n<div .wrapper>\n  <uc-tabs\n    tab-list="tab-view, tab-details">\n    <div \n      tab-ctx="tab-details"\n      ref="details" \n      class="details">\n\n      <div class="info-block">\n        <div class="info-block_name" l10n="file-name"></div>\n        <input\n          name="name-input"\n          ref="file_name_input"\n          set="value: fileName; oninput: onNameInput"\n          type="text" />\n      </div>\n\n      <div class="info-block">\n        <div class="info-block_name" l10n="file-size"></div>\n        <div set="textContent: fileSize"></div>\n      </div>\n\n      <div class="info-block">\n        <div class="info-block_name" l10n="cdn-url"></div>\n        <a\n          target="_blank"\n          set="textContent: cdnUrl; @href: cdnUrl;"></a>\n      </div>\n\n      <div set="textContent: errorTxt;"></div>\n\n    </div>\n\n    <div tab-ctx="tab-view" ref="viewport" class="viewport">\n      <uc-editable-canvas\n        tab-ctx="tab-view"\n        ref="canvas">\n      </uc-editable-canvas>\n    </div>\n  </uc-tabs>\n\n  <div class="toolbar">\n    <button\n      class="edit-btn secondary-btn"\n      set="onclick: onEdit; @hidden: editBtnHidden;">\n      <uc-icon name="edit"></uc-icon>\n      <span l10n="edit-image"></span>\n    </button>\n    <button\n      class="remove-btn secondary-btn"\n      set="onclick: onRemove">\n      <uc-icon name="remove"></uc-icon>\n      <span l10n="remove-from-list"></span>\n    </button>\n    <div></div>\n    <button\n      class="back-btn primary-btn"\n      set="onclick: onBack">\n      <span l10n="done"></span>\n    </button>\n  </div>\n</div>\n';var ce=class extends Z{constructor(){super(...arguments),U(this,"init$",{cssWidth:0,"*commonProgress":0})}initCallback(){this.sub("*commonProgress",(t=>{0===t||100===t?this.removeAttribute("active"):this.setAttribute("active",""),this.$.cssWidth=t+"%"}))}};ce.template='\n<div\n  class="bar"\n  set="style.width: cssWidth">\n</div>\n';var ue="http://www.w3.org/2000/svg",he=class{_syncSvgSize(){let t=this.svgGroupEl.getBoundingClientRect();V(this.svgEl,{viewBox:`0, 0, ${t.width}, ${t.height}`,width:t.width,height:t.height})}_syncCanvas(){return new Promise(((t,e)=>{let i=URL.createObjectURL(new Blob([this.svgEl.outerHTML],{type:"image/svg+xml"}));this.vImg.onload=()=>{this.can.height=this.vImg.height,this.can.width=this.vImg.width,this.ctx.drawImage(this.vImg,0,0,this.vImg.width,this.vImg.height),t()},this.vImg.onerror=()=>{e()},this.vImg.src=i}))}_backSyncSvg(){return this.svgGroupEl.style.transform=null,this.svgGroupEl.style.filter=null,V(this.svgEl,{viewBox:`0, 0, ${this.can.width}, ${this.can.height}`,width:this.can.width,height:this.can.height}),V(this.svgImgEl,{href:this.can.toDataURL("image/png"),width:this.can.width,height:this.can.height}),this._addedObjects.forEach((t=>{t.remove()})),new Promise(((t,e)=>{this.svgImgEl.onload=()=>{t()},this.svgImgEl.onerror=()=>{e()}}))}async _syncAll(){this._syncSvgSize(),await this._syncCanvas(),await this._backSyncSvg()}constructor(t){this.can=t.canvas,this.svgEl=t.svg,this.svgGroupEl=t.svgGroup,this.svgImgEl=t.svgImg,this.vImg=new Image,this.ctx=t.canvCtx,this.currentColor=he.defaultColor,this._addedObjects=new Set,window.setTimeout((()=>{this._backSyncSvg()}),100)}applyCss(t){X(this.svgGroupEl,t)}getImg(){let t=new Image;return t.src=this.can.toDataURL("image/png"),new Promise(((e,i)=>{t.onload=()=>{e(t)},t.onerror=()=>{i(t)}}))}rotate(){this.applyCss({"transform-origin":"0 0",transform:`rotate(90deg) translateY(-${this.can.height}px)`}),this._syncAll()}flip(t){this.applyCss({"transform-origin":"50% 50%",transform:`scale(${"vertical"===t?"1, -1":"-1, 1"})`}),this._syncAll()}brightness(t){this.applyCss({filter:`brightness(${t}%)`})}contrast(t){this.applyCss({filter:`contrast(${t}%)`})}saturate(t){this.applyCss({filter:`saturate(${t}%)`})}setColor(t){this.currentColor=t}startText(){let t=e=>{let i=document.createElementNS(ue,"text");V(i,{fill:this.currentColor,x:e.offsetX,y:e.offsetY}),i.textContent="TEXT",this.svgGroupEl.appendChild(i),this._addedObjects.add(i),i.focus(),this.svgEl.removeEventListener("mousedown",t)};this.svgEl.addEventListener("mousedown",t)}stopText(){this.bake()}startDraw(){this.svgEl.addEventListener("mousedown",(t=>{let e=document.createElementNS(ue,"polyline");V(e,{fill:"none",stroke:this.currentColor,"stroke-width":"4px"}),this.svgGroupEl.appendChild(e),this._addedObjects.add(e);let i=[];this.svgEl.onmousemove=t=>{i.push(`${t.offsetX},${t.offsetY}`),e.setAttribute("points",i.join(" "))}})),window.addEventListener("mouseup",(()=>{this.svgEl.onmousemove=null,this.bake()})),window.addEventListener("mouseleave",(()=>{this.svgEl.onmousemove=null,this.bake()}))}removeMode(t){}resize(){}crop(){}bake(){this._syncAll()}restore(){}};he.defaultColor="#f00";var de=class extends Z{constructor(){super(...arguments),U(this,"init$",{cssLeft:"50%",caption:"CAPTION",barActive:!1,"*rangeValue":100,onChange:()=>{this.$["*rangeValue"]=this.ref.range.value}})}initCallback(){[...this.attributes].forEach((t=>{["style","ref"].includes(t.name)||this.ref.range.setAttribute(t.name,t.value)})),this.sub("*rangeValue",(t=>{let e=t/this.ref.range.max*100;this.$.cssLeft=`${e}%`}))}};de.template='\n<datalist id="range-values">\n  <option value="0" label="min"></option>\n  <option value="100" label="0"></option>\n  <option value="200" label="max"></option>\n</datalist>\n<div class="track">\n  <div class="bar" set="style.width: cssLeft; @active: barActive"></div>\n  <div class="slider" set="style.left: cssLeft"></div>\n  <div class="center"></div>\n  <div class="caption" set="textContent: caption; @text: caption"></div>\n</div>\n<input \n  type="range"\n  ref="range"\n  list="range-values" \n  set="@value: *rangeValue; oninput: onChange">\n';var pe=class extends Z{constructor(){super(...arguments),U(this,"init$",{inputOpacity:0,"*selectedColor":"#f00",onChange:()=>{this.$["*selectedColor"]=this.ref.input.value}})}};pe.template='\n<input \n  ref="input"\n  type="color" \n  set="oninput: onChange; style.opacity: inputOpacity">\n<div \n  class="current-color"\n  set="style.backgroundColor: *selectedColor">\n</div>\n';var me=[{action:"fullscreen",icon:"",l10n_name:"toggle-fullscreen",set:"@name: fsIcon"},{action:"rotate_cw",icon:"edit-rotate",l10n_name:"rotate",set:""},{action:"flip_v",icon:"edit-flip-v",l10n_name:"flip-vertical",set:""},{action:"flip_h",icon:"edit-flip-h",l10n_name:"flip-horizontal",set:""},{action:"brightness",icon:"edit-brightness",l10n_name:"brightness",set:""},{action:"contrast",icon:"edit-contrast",l10n_name:"contrast",set:""},{action:"saturation",icon:"edit-saturation",l10n_name:"saturation",set:""},{clr:!0},{action:"text",icon:"edit-text",l10n_name:"text",set:""},{action:"draw",icon:"edit-draw",l10n_name:"draw",set:""},{action:"cancel",icon:"close",l10n_name:"cancel-edit",set:""}];de.reg("range"),pe.reg("color");var ge="fullscreen",fe="fullscreen-exit",ve=class extends Z{constructor(){super(...arguments),U(this,"init$",{fsIcon:ge,rangeActive:!1,rangeCaption:"",onBtnClick:t=>{this.canMan.stopText(),this.rangeCtx=null,this.set$({rangeActive:!1,rangeCaption:"","*rangeValue":100});let e=t.target.closest("[action]");e&&(this.buttons.add(e),this.buttons.forEach((t=>{t===e?t.setAttribute("current",""):t.removeAttribute("current","")})));let i=e.getAttribute("action");console.log(i),i&&this.actionsMap[i]()}}),U(this,"buttons",new Set),U(this,"editor",null)}get actionsMap(){return{fullscreen:()=>{document.fullscreenElement===this.rMap.parent?(document.exitFullscreen(),this.$.fsIcon=ge):(this.rMap.parent.requestFullscreen(),this.$.fsIcon=fe)},rotate_cw:()=>{this.canMan.rotate()},flip_v:()=>{this.canMan.flip("vertical")},flip_h:()=>{this.canMan.flip("horizontal")},brightness:()=>{this.rangeCtx="brightness",this.set$({rangeActive:!0,rangeCaption:this.l10n("brightness")})},contrast:()=>{this.rangeCtx="contrast",this.set$({rangeActive:!0,rangeCaption:this.l10n("contrast")})},saturation:()=>{this.rangeCtx="saturate",this.set$({rangeActive:!0,rangeCaption:this.l10n("saturation")})},resize:()=>{this.canMan.resize()},crop:()=>{this.canMan.crop()},color:()=>{this.ref.color.dispatchEvent(new MouseEvent("click"))},text:()=>{this.canMan.startText()},draw:()=>{this.canMan.startDraw()},cancel:()=>{this.canMan.restore()}}}initCallback(){this.defineAccessor("refMap",(t=>{!t||(this.rMap=t,this.canMan=new he(t),console.log(t))})),this.sub("*rangeValue",(t=>{var e,i;null==(i=null==(e=this.canMan)?void 0:e[this.rangeCtx])||i.call(e,t)})),this.sub("*selectedColor",(t=>{var e;null==(e=this.canMan)||e.setColor(t)}))}};ve.template=`\n<div \n  class="btns"\n  ref="btns" \n  set="onclick: onBtnClick">${me.reduce(((t,e)=>t+(e.clr?'<uc-color \n  ref="color" \n  action="color"\n  set="onchange: onColor" \n  l10n="title:select-color"></uc-color>':function(t){return`<button \n  action="${t.action}" \n  ref="${t.ref}"\n  l10n="title:${t.l10n_name}">\n  <uc-icon\n    set="${t.set}" \n    name="${t.icon}">\n  </uc-icon>\n</button>`.trim()}(e))),"")}</div>\n<uc-range \n  min="0" \n  max="200" \n  ref="range"\n  set="@visible: rangeActive; $.caption: rangeCaption">\n</uc-range>\n`,ve.reg("editor-toolbar");var be=class extends Z{constructor(){super(),U(this,"init$",{refMap:null}),X(this,{display:"flex",justifyContent:"center",alignItems:"center"})}initCallback(){this.style.backgroundImage=`url(${function(t="#fff",e="rgba(0, 0, 0, .1)"){return te+btoa(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <rect x="0" y="0" width="20" height="20" fill="${t}" />\n    <rect x="0" y="0" width="10" height="10" fill="${e}" />\n    <rect x="10" y="10" width="10" height="10" fill="${e}" />\n  </svg>`)}()})`,this.canvas=this.ref.cvs,this.canvCtx=this.canvas.getContext("2d"),this.$.refMap={parent:this,canvas:this.canvas,canvCtx:this.canvCtx,svg:this.ref.svg,svgGroup:this.ref.svg_g,svgImg:this.ref.svg_img}}setImage(t){t.height&&t.width?(this.canvas.height=t.height,this.canvas.width=t.width,this.canvCtx.drawImage(t,0,0,t.width,t.height)):t.onload=()=>{this.canvas.height=t.height,this.canvas.width=t.width,this.canvCtx.drawImage(t,0,0,t.width,t.height)}}setImageFile(t){let e=new Image,i=URL.createObjectURL(t);e.src=i,this.setImage(e)}setImageUrl(t){let e=new Image;e.src=t,this.setImage(e)}};be.template='\n<canvas class="img-view" ref="cvs"></canvas>\n<svg class="img-view" xmlns="http://www.w3.org/2000/svg" ref="svg">\n  <g ref="svg_g">\n    <image ref="svg_img" x="0" y="0"></image>\n  </g>\n</svg>\n<uc-editor-toolbar \n  set="refMap: refMap">\n</uc-editor-toolbar>\n';var ye=class extends Z{constructor(){super(...arguments),U(this,"activityType",Z.activities.CLOUD_IMG_EDIT),U(this,"init$",{uuid:null})}loadScript(){let t=document.createElement("script");t.src="https://ucarecdn.com/libs/editor/0.0.1-alpha.0.9/uploadcare-editor.js",t.setAttribute("type","module"),document.body.appendChild(t)}initCallback(){this.style.display="flex",this.style.position="relative",this.loadScript(),this.sub("*currentActivity",(t=>{t===Z.activities.CLOUD_IMG_EDIT?this.mountEditor():this.unmountEditor()})),this.sub("*focusedEntry",(t=>{!t||(this.entry=t,this.entry.subscribe("uuid",(t=>{t&&(this.$.uuid=t)})))}))}handleApply(t){let e=t.detail,{transformationsUrl:i}=e;this.entry.setValue("transformationsUrl",i),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=new(window.customElements.get("uc-editor")),e=this.$.uuid,i=this.cfg("pubkey");t.setAttribute("uuid",e),t.setAttribute("public-key",i),t.addEventListener("apply",(t=>this.handleApply(t))),t.addEventListener("cancel",(()=>this.handleCancel())),this.innerHTML="",this.style.width="600px",this.style.height="400px",this.appendChild(t)}unmountEditor(){this.style.width="0px",this.style.height="0px",this.innerHTML=""}},_e={};window.addEventListener("message",(t=>{let e;try{e=JSON.parse(t.data)}catch(t){return}if((null==e?void 0:e.type)in _e){let i=_e[e.type];for(let[s,n]of i)t.source===s&&n(e)}}));var Ce=t=>Object.keys(t).reduce(((e,i)=>{let s=t[i];return e+`${i}{${Object.keys(s).reduce(((t,e)=>t+`${e}: ${s[e]};`),"")}}`}),""),we=class extends Z{constructor(){super(...arguments),U(this,"activityType",Z.activities.EXTERNAL),U(this,"init$",{counter:0,onDone:()=>{this.$["*currentActivity"]=Z.activities.UPLOAD_LIST},onCancel:()=>{this.set$({"*currentActivity":Z.activities.SOURCE_SELECT})}}),U(this,"_iframe",null)}initCallback(){this.registerActivity(this.activityType,(()=>{let{externalSourceType:t}=this.activityParams;this.set$({"*modalCaption":`${t[0].toUpperCase()}${t.slice(1)}`,"*modalIcon":t}),this.$.counter=0,this.mountIframe()}),(()=>{this.unmountIframe()}))}sendMessage(t){this._iframe.contentWindow.postMessage(JSON.stringify(t),"*")}async handleFileSelected(t){this.$.counter=this.$.counter+1;let{url:e}=t,i=this.cfg("pubkey"),s=this.uploadCollection.add({externalUrl:e}),n=await Zt(e,{publicKey:i,onProgress:t=>{let e=100*t.value;s.setValue("uploadProgress",e)}});console.log(n),s.setMultipleValues({uuid:n.uuid,fileName:n.name,fileSize:n.size,isImage:n.isImage,mimeType:n.mimeType})}handleIframeLoad(t){this.applyStyles()}getCssValue(t){return window.getComputedStyle(this).getPropertyValue(t).trim()}applyStyles(){let t={body:{color:this.getCssValue("--clr-txt")},".side-bar":{"background-color":this.getCssValue("--clr-background-light")},".list-table-row":{color:this.getCssValue("--clr-txt")},".list-table-row:hover":{background:this.getCssValue("--clr-shade-lv1")}};this.sendMessage({type:"embed-css",style:Ce(t)})}remoteUrl(){let t=this.cfg("pubkey"),e=(!1).toString(),{externalSourceType:i}=this.activityParams;return`https://social.uploadcare.com/window3/${i}?lang=en&public_key=${t}&widget_version=3.11.3&images_only=${e}&pass_window_open=false`}mountIframe(){let t=document.createElement("iframe");t.addEventListener("load",this.handleIframeLoad.bind(this)),t.setAttribute("src",this.remoteUrl()),t.setAttribute("marginheight","0"),t.setAttribute("marginwidth","0"),t.setAttribute("frameborder","0"),t.setAttribute("allowTransparency","true");let e=this.ref["iframe-wrapper"];e.innerHTML="",e.appendChild(t),function(t,e,i){t in _e||(_e[t]=[]),_e[t].push([e,i])}("file-selected",t.contentWindow,this.handleFileSelected.bind(this)),this._iframe=t}unmountIframe(){!function(t,e){t in _e&&(_e[t]=_e[t].filter((t=>t[0]!==e)))}("file-selected",this._iframe.contentWindow),this.ref["iframe-wrapper"].innerHTML="",this._iframe=void 0}};we.template='\n<div ref="iframe-wrapper" class="iframe-wrapper">\n</div>\n<div class="toolbar">\n  <button\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel"\n    l10n="cancel">\n  </button>\n  <div></div>\n  <div class="selected-counter">\n    <span l10n="selected-count"></span>\n    <span set="textContent: counter"></span>\n  </div>\n  <button class="done-btn primary-btn" set="onclick: onDone">\n    <uc-icon name="check"></uc-icon>\n  </button>\n</div>\n';var Te=class extends Z{setCurrentTab(t){if(t){[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach((e=>{e.getAttribute("tab-ctx")===t?e.removeAttribute("hidden"):e.setAttribute("hidden","")}));for(let e in this._tabMap)e===t?this._tabMap[e].setAttribute("current",""):this._tabMap[e].removeAttribute("current")}}initCallback(){this._tabMap={},this.defineAccessor("tab-list",(t=>{t&&t.split(",").map((t=>t.trim())).forEach((t=>{let e=z({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(t)}}});e.textContent=this.l10n(t),this.ref.row.appendChild(e),this._tabMap[t]=e}))})),this.defineAccessor("default",(t=>{this.setCurrentTab(t)})),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};Te.bindAttributes({"tab-list":null,default:null}),Te.template='\n<div ref="row" class="tabs-row"></div>\n<div ref="context" class="tabs-context">\n  <slot></slot>\n</div>\n';var xe=class extends Z{initCallback(){let t=this.getAttribute("from");this.sub(t||xe.defaultFrom,(t=>{if(t){if(this.hasAttribute(xe.fireEventAttrName)&&this.dispatchEvent(new CustomEvent(xe.outputEventName,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:t}})),this.hasAttribute(xe.templateAttrName)){let e=this.getAttribute(xe.templateAttrName),i="";t.forEach((t=>{let s=e;for(let e in t)s=s.split(`{{${e}}}`).join(t[e]);i+=s})),this.innerHTML=i}this.value=t,this.hasAttribute(xe.formValueAttrName)&&(this._input||(this._input=document.createElement("input"),this._input.type="text",this.appendChild(this._input)),this._input.value=JSON.stringify(t))}else this.innerHTML=""}))}};xe.outputEventName="data-output",xe.templateAttrName="item-template",xe.fireEventAttrName="fire-event",xe.formValueAttrName="form-value",xe.defaultFrom="*outputData";var Ae=class extends Z{constructor(){super(...arguments),U(this,"init$",{"*modalCaption":void 0})}};Ae.template='\n<div\n  class="caption"\n  set="textContent: *modalCaption">\n</div>\n';var Ee=class extends Z{constructor(){super(...arguments),U(this,"init$",{"*modalIcon":"default"})}};Ee.template='\n<uc-icon set="@name: *modalIcon"></uc-icon>\n';var $e=class extends L.BlockComponent{};function Se(t,e,i){const s=t.slice();return s[2]=e[i],s}function Re(t){let e,i;return{c(){e=d("img"),l(e.src,i="https://ucarecdn.com/"+t[2].uuid+"/-/preview/-/scale_crop/400x400/")||m(e,"src",i),m(e,"width","200"),m(e,"alt","Uploadcare uploaded file")},m(t,i){u(t,e,i)},p(t,s){1&s&&!l(e.src,i="https://ucarecdn.com/"+t[2].uuid+"/-/preview/-/scale_crop/400x400/")&&m(e,"src",i)},d(t){t&&h(e)}}}function ke(e){let i,s,n,r,a,o,l,f,v,b=e[0],y=[];for(let t=0;t<b.length;t+=1)y[t]=Re(Se(e,b,t));return{c(){i=d("div"),s=d("div"),n=d("uc-default-widget"),r=p(),a=d("uc-data-output"),o=p(),l=d("div");for(let t=0;t<y.length;t+=1)y[t].c();g(n,"class","uc-wgt-common"),g(a,"fire-event",""),g(a,"class","uc-wgt-common"),m(s,"class","uploader svelte-1wnxqtt"),m(l,"class","output svelte-1wnxqtt"),m(i,"class","wrapper svelte-1wnxqtt")},m(t,h){u(t,i,h),c(i,s),c(s,n),c(s,r),c(s,a),c(i,o),c(i,l);for(let t=0;t<y.length;t+=1)y[t].m(l,null);var d,p,m,g;f||(d=a,p="data-output",m=e[1],d.addEventListener(p,m,g),v=()=>d.removeEventListener(p,m,g),f=!0)},p(t,[e]){if(1&e){let i;for(b=t[0],i=0;i<b.length;i+=1){const s=Se(t,b,i);y[i]?y[i].p(s,e):(y[i]=Re(s),y[i].c(),y[i].m(l,null))}for(;i<y.length;i+=1)y[i].d(1);y.length=b.length}},i:t,o:t,d(t){t&&h(i),function(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}(y,t),f=!1,v()}}}function Ie(t,e,i){let s=[];return[s,function(t){const{data:e}=t.detail;i(0,s=e)}]}$e.template="\n<uc-simple-btn></uc-simple-btn>\n\n<uc-modal strokes>\n  <uc-start-from>\n    <uc-source-list wrap></uc-source-list>\n    <uc-drop-area></uc-drop-area>\n  </uc-start-from>\n  <uc-upload-list></uc-upload-list>\n  <uc-camera-source></uc-camera-source>\n  <uc-url-source></uc-url-source>\n  <uc-external-source></uc-external-source>\n  <uc-upload-details></uc-upload-details>\n  <uc-confirmation-dialog></uc-confirmation-dialog>\n</uc-modal>\n\n<uc-message-box></uc-message-box>\n<uc-progress-bar></uc-progress-bar>\n",$e.reg("default-widget"),"undefined"!=typeof window&&function(){var t,e;for(let i in L){let s=[...i].reduce(((t,e)=>(e.toUpperCase()===e&&(e="-"+e.toLowerCase()),t+e)),"");s.startsWith("-")&&(s=s.replace("-","")),null==(e=(t=L[i]).reg)||e.call(t,s)}}();return new class extends class{$destroy(){!function(t,e){const i=t.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),k(this,t,Ie,ke,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
